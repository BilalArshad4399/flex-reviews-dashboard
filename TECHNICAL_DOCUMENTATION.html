<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flex Reviews Dashboard - Technical Documentation</title>
    <style>
        @page {
            size: A4;
            margin: 20mm;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #284E4C;
            border-bottom: 3px solid #284E4C;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        h2 {
            color: #3a6562;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        h3 {
            color: #4a7572;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .tech-category {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
        }
        .tech-category h4 {
            margin: 0 0 10px 0;
            color: #284E4C;
        }
        .tech-category ul {
            margin: 0;
            padding-left: 20px;
        }
        .api-endpoint {
            background: #f0f8ff;
            border-left: 4px solid #284E4C;
            padding: 10px;
            margin: 10px 0;
        }
        .api-endpoint code {
            font-weight: bold;
            color: #284E4C;
        }
        .critical-endpoint {
            background: #ffe0e0;
            border-left: 4px solid #d9534f;
        }
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .info-box {
            background: #e8f4f8;
            border: 1px solid #17a2b8;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .links-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .links-section ul {
            list-style-type: none;
            padding-left: 0;
        }
        .links-section li {
            margin: 10px 0;
        }
        .links-section strong {
            display: inline-block;
            width: 200px;
        }
        .links-section a {
            color: #284E4C;
            text-decoration: none;
        }
        .links-section a:hover {
            text-decoration: underline;
        }
        code {
            background: #f4f4f4;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        ul {
            line-height: 1.8;
        }
        @media print {
            body {
                font-size: 11pt;
            }
            h1 {
                font-size: 18pt;
            }
            h2 {
                font-size: 14pt;
            }
            .tech-stack {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>Flex Reviews Dashboard - Technical Documentation</h1>
    
    <h2>Project Overview</h2>
    <p>The Flex Reviews Dashboard is a comprehensive review management system designed for vacation rental properties. It provides centralized management for reviews with advanced filtering, analytics, and bulk management capabilities.</p>

    <h2>Project Hosting & Access</h2>
    <div class="links-section">
        <ul>
            <li><strong>Main Page:</strong> <a href="https://flex-reviews-dashboard-mu.vercel.app/">https://flex-reviews-dashboard-mu.vercel.app/</a></li>
            <li><strong>Admin Dashboard:</strong> <a href="https://flex-reviews-dashboard-mu.vercel.app/admin">https://flex-reviews-dashboard-mu.vercel.app/admin</a></li>
            <li><strong>Properties Listing:</strong> <a href="https://flex-reviews-dashboard-mu.vercel.app/properties">https://flex-reviews-dashboard-mu.vercel.app/properties</a></li>
            <li><strong>Property Detail (175160):</strong> <a href="https://flex-reviews-dashboard-mu.vercel.app/property/175160">https://flex-reviews-dashboard-mu.vercel.app/property/175160</a></li>
            <li><strong>Property Detail (128652):</strong> <a href="https://flex-reviews-dashboard-mu.vercel.app/property/128652">https://flex-reviews-dashboard-mu.vercel.app/property/128652</a></li>
            <li><strong>Google Reviews:</strong> <a href="https://flex-reviews-dashboard-mu.vercel.app/google-reviews">https://flex-reviews-dashboard-mu.vercel.app/google-reviews</a></li>
        </ul>
        <p><em>Local setup instructions are available in the README.md file</em></p>
    </div>

    <h2>Technology Stack</h2>
    <div class="tech-stack">
        <div class="tech-category">
            <h4>Frontend</h4>
            <ul>
                <li>Next.js 15.1.6 (App Router)</li>
                <li>React 19</li>
                <li>TypeScript 5</li>
                <li>Tailwind CSS 3.4</li>
                <li>Framer Motion</li>
                <li>Recharts (dashboard charts)</li>
                <li>Lucide React (icons)</li>
            </ul>
        </div>
        <div class="tech-category">
            <h4>Backend</h4>
            <ul>
                <li>Next.js API Routes</li>
                <li>Supabase (PostgreSQL)</li>
                <li>Node.js Runtime</li>
                <li>SHA256 Content Hashing</li>
            </ul>
        </div>
    </div>

    <h2>Key Design & Logic Decisions</h2>
    
    <h3>1. Database Architecture</h3>
    <ul>
        <li>Separate tables for different review sources (reviews, google_reviews)</li>
        <li>Content hashing (SHA256) for efficient sync detection</li>
        <li>Normalized structure with foreign key relationships</li>
        <li>Status tracking (pending/approved) for review moderation</li>
    </ul>

    <h3>2. Sync Mechanism</h3>
    <ul>
        <li>Smart sync using content hashes to detect changes</li>
        <li>Only updates modified reviews (reduces API calls)</li>
        <li>Preserves approval status during updates</li>
        <li>Batch processing with error resilience</li>
    </ul>

    <h3>3. UI/UX Design</h3>
    <ul>
        <li>Tab-based navigation for different functions</li>
        <li>Real-time filtering without page reloads</li>
        <li>Bulk selection with "Select All" functionality</li>
        <li>Responsive design with mobile support</li>
        <li>Performance metrics visualization</li>
    </ul>

    <h3>4. Dashboard Analytics</h3>
    <ul>
        <li>Interactive charts using Recharts library</li>
        <li>Review trends visualization over time</li>
        <li>Rating distribution charts</li>
        <li>Property performance metrics</li>
        <li>Response rate analytics</li>
        <li>Real-time data updates</li>
    </ul>

    <h3>5. State Management</h3>
    <ul>
        <li>React hooks for local state</li>
        <li>Server-side rendering for initial data</li>
        <li>Optimistic UI updates for better UX</li>
        <li>Client-side caching for performance</li>
    </ul>

    <h2>API Behaviors & Endpoints</h2>
    
    <div class="api-endpoint">
        <code>GET /api/reviews</code>
        <p>Fetches all reviews with approval status and categories</p>
    </div>
    
    <div class="api-endpoint">
        <code>POST /api/ingest</code>
        <p>Syncs reviews from fixtures using content hashing<br>
        Returns: {processed, updated, skipped, errors}</p>
    </div>
    
    <div class="api-endpoint">
        <code>POST /api/reviews/[id]/approve</code>
        <p>Toggles review approval status<br>
        Body: {approved: boolean, approvedBy: string}</p>
    </div>
    
    <div class="api-endpoint">
        <code>GET /api/reviews/google</code>
        <p>Fetches Google reviews from database</p>
    </div>
    
    <div class="api-endpoint">
        <code>POST /api/reviews/google/fetch</code>
        <p>Syncs from external GoSign API</p>
    </div>

    <div class="api-endpoint critical-endpoint">
        <code>GET /api/reviews/hostaway</code> <strong>CRITICAL FOR TESTING</strong>
        <p>Returns properly structured and filtered review data. Only passes approved reviews to frontend. Includes property information and metadata. Response format optimized for frontend consumption.</p>
    </div>

    <h2>Hostaway API Integration</h2>
    
    <div class="info-box">
        <strong>Authentication Success</strong>
        <p>Successfully authenticated with Hostaway API. Authentication screenshots are available in the "postman hostaway/" folder demonstrating proper OAuth2 implementation, token management, and refresh handling.</p>
    </div>

    <h3>Implementation Steps</h3>
    <ol>
        <li><strong>Data Source:</strong> Reviews data stored in JSON file (fixtures/hostaway_reviews.json)</li>
        <li><strong>Data Ingestion:</strong> POST /api/ingest route reads from source and saves data to database</li>
        <li><strong>Database Operations:</strong> Dashboard actions (approve/reject) directly modify data in database</li>
        <li><strong>Data Filtering:</strong> GET /api/reviews/hostaway converts to structured format optimized for frontend</li>
        <li><strong>Approval Control:</strong> Only approved reviews are passed to frontend through the hostaway endpoint</li>
    </ol>

    <h2>Google Reviews Integration - Findings</h2>
    
    <div class="warning-box">
        <strong>Important Note:</strong> Could not obtain Google Places API key. Google Reviews are fetched through an external API service, not through Google Places API directly.
    </div>

    <h3>Demonstration Data Source</h3>
    <ul>
        <li><strong>Business:</strong> REDDY Küchen Ansbach (Kitchen Store in Germany)</li>
        <li><strong>Google URL:</strong> <a href="https://www.google.com/search?q=REDDY+Küchen+Ansbach+Reviews">View on Google</a></li>
        <li><strong>Purpose:</strong> UI/UX demonstration and functionality testing</li>
    </ul>

    <h3>External API Integration</h3>
    <div class="info-box">
        <p><strong>Endpoint:</strong> <code>https://dashboard.gosign.de/review/api/{API_KEY}/reviews-list.json</code></p>
        <p><strong>API Key Location:</strong> <code>.env.local</code> file (<code>REVIEWS_API_SECRET_KEY</code>)</p>
        <p><strong>Test Key:</strong> <code>6320d973f681d71fa0a9427d51c5b630</code> (for verification purposes)</p>
        <p><strong>Data Source:</strong> Third-party aggregation service</p>
    </div>

    <h3>Implementation Details</h3>
    <ol>
        <li>Created dedicated google_reviews table in database</li>
        <li>Implemented fetch endpoint at /api/reviews/google/fetch</li>
        <li>Data transformation from German to English</li>
        <li>Rating conversion (star ratings to numeric values)</li>
        <li>Pagination with "Load More" functionality</li>
        <li>Responsive card-based layout</li>
    </ol>

    <h3>Technical Findings</h3>
    <ul>
        <li>Successfully integrated external API with error handling</li>
        <li>Implemented duplicate prevention using review_id</li>
        <li>Created update mechanism for existing reviews</li>
        <li>Added timestamp tracking for data freshness</li>
        <li>Null rating handling for incomplete reviews</li>
    </ul>

    <h3>Limitations</h3>
    <ul>
        <li>Data is from a German business (translated to English)</li>
        <li>Used for demonstration of technical capability only</li>
    </ul>

    <h2>Critical Implementation Notes</h2>
    
    <h3>Environment Variables</h3>
    <ul>
        <li><code>NEXT_PUBLIC_SUPABASE_URL</code>: Public Supabase endpoint</li>
        <li><code>SUPABASE_SERVICE_ROLE_KEY</code>: Admin access for database</li>
        <li><code>REVIEWS_API_SECRET_KEY</code>: External API authentication</li>
    </ul>

    <h3>Database Migrations</h3>
    <ul>
        <li>Must run SQL migrations before first use</li>
        <li>Content_hash column is required for sync</li>
        <li>Status field cannot be NULL</li>
    </ul>

    <h3>Error Handling</h3>
    <ul>
        <li>All API endpoints have try-catch blocks</li>
        <li>Database errors are logged with context</li>
        <li>User-friendly error messages returned</li>
    </ul>

    <h3>Performance Optimizations</h3>
    <ul>
        <li>Lazy loading for review lists</li>
        <li>Pagination limits (20 items default)</li>
        <li>Client-side filtering for instant response</li>
        <li>Indexed database columns for quick queries</li>
    </ul>

    <div style="margin-top: 40px; text-align: center; color: #666; font-size: 0.9em;">
        <p>Technical Documentation - Flex Reviews Dashboard</p>
    </div>
</body>
</html>